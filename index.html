 
  <!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Photo Grid — 100 Frames</title>
  <style>
    :root{
      --bg:#0b0d10; --card:#13171c; --muted:#aab3c2; --accent:#4da3ff; --accent2:#7bffb2; --ring:#2a6cff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:radial-gradient(1200px 800px at 10% -10%,#112 0%,transparent 70%),linear-gradient(180deg,#0b0d10,#0a0c0f 60%,#080a0d);color:#e7ecf3;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
    header{position:sticky;top:0;z-index:5;background:linear-gradient(180deg,rgba(11,13,16,.9),rgba(11,13,16,.6));backdrop-filter:blur(8px);border-bottom:1px solid #20242a}
    .inner{max-width:1200px;margin:0 auto;padding:16px}
    .title{display:flex;gap:12px;align-items:center}
    .title h1{font-size:20px;letter-spacing:.3px;margin:0}
    .title .badge{font-size:12px;padding:3px 8px;border-radius:999px;background:#10161f;border:1px solid #263040;color:#aab3c2}
    .bar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-top:10px}
    button, .btn{background:#1b2330;border:1px solid #2a3342;color:#d6deea;border-radius:10px;padding:10px 14px;cursor:pointer}
    button:hover{border-color:#3b4960}
    button.primary{background:linear-gradient(180deg,#2a6cff,#1f5be0);border-color:#2b62ff}

    /* Grid */
    .grid{max-width:1200px;margin:20px auto;display:grid;grid-template-columns:repeat(10,1fr);gap:10px;padding:10px}
    .cell{position:relative;aspect-ratio:1/1;border-radius:14px;background:linear-gradient(180deg,#121821,#0f141b);border:1px solid #1e2634;overflow:hidden}
    .cell input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer}
    .cell .placeholder{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;color:#94a3b8;font-size:12px;gap:6px}
    .cell .placeholder svg{opacity:.9}
    .thumb{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
    .cell .overlay{position:absolute;inset:auto 8px 8px 8px;display:flex;justify-content:space-between;align-items:center;gap:8px}
    .cell .overlay .edit{padding:6px 10px;border-radius:999px;background:rgba(10,14,20,.7);backdrop-filter:blur(4px);border:1px solid #223;cursor:pointer}

    /* Modal */
    .modalBack{position:fixed;inset:0;background:rgba(9,11,14,.6);backdrop-filter:blur(6px);display:none;align-items:center;justify-content:center;z-index:50}
    .modal{width:min(1000px,92vw);height:min(720px,88vh);background:#0e141b;border:1px solid #243044;border-radius:18px;overflow:hidden;display:grid;grid-template-columns:1.2fr .8fr}
    .modal img{width:100%;height:100%;object-fit:contain;background:#0a0d12}
    .side{display:flex;flex-direction:column}
    .side header{position:relative;background:#0f1621;border-bottom:1px solid #243044}
    .side header h3{margin:0;font-size:16px}
    .meta{padding:14px 16px;display:flex;gap:10px;align-items:center;color:#aab3c2}
    .meta .dot{width:8px;height:8px;border-radius:50%;background:var(--accent)}
    textarea{flex:1;resize:none;background:#0c1219;border:1px solid #223043;color:#dce6f5;margin:16px;border-radius:12px;padding:12px;line-height:1.35}
    .row{display:flex;gap:10px;align-items:center;justify-content:space-between;padding:0 16px 16px}
    .row .muted{color:#aab3c2;font-size:12px}
    .danger{background:linear-gradient(180deg,#3b1c1c,#2a1414);border-color:#5a2a2a}

    .toast{position:fixed;right:16px;bottom:16px;background:#0f1722;border:1px solid #293346;padding:10px 12px;border-radius:10px;color:#cde2ff;display:none}

    @media (max-width:900px){
      .modal{grid-template-columns:1fr;grid-template-rows:auto 1fr}
      .modal img{max-height:50vh}
    }
  </style>
</head>
<body>
  <header>
    <div class="inner">
      <div class="title">
        <h1>Photo Grid — 100 Frames</h1>
        <span class="badge" id="authState">Connecting…</span>
      </div>
      <div class="bar">
        <button id="signOutBtn" style="display:none">Sign out</button>
        <button id="exportJSON" title="Download all metadata as JSON">Export JSON</button>
        <label class="btn" for="bulkUpload">Bulk upload (up to 100)</label>
        <input id="bulkUpload" type="file" accept="image/*" multiple style="display:none" />
      </div>
    </div>
  </header>

  <main class="grid" id="grid"></main>

  <!-- Modal for viewing & editing description -->
  <div class="modalBack" id="modalBack" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <img id="modalImg" alt="Selected image" />
      <div class="side">
        <header>
          <div class="meta">
            <span class="dot"></span>
            <div>
              <h3 id="modalTitle">Frame</h3>
              <div class="muted" id="modalSub">Updated —</div>
            </div>
          </div>
        </header>
        <textarea id="desc" placeholder="Write a description…"></textarea>
        <div class="row">
          <div class="muted">Autosaves online</div>
          <div style="display:flex;gap:8px">
            <button class="danger" id="deleteBtn" title="Remove image & description from this frame">Delete</button>
            <button class="primary" id="closeBtn">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">Saved ✓</div>

  <!-- Firebase (Compat SDK for easiest no-build setup) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage-compat.js"></script>

  <script type="module">
    // 1) Paste your Firebase web config here (Project Settings → General → Your apps → SDK setup & config)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // 2) Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    // Enable local cache (optional but nice)
    db.enablePersistence().catch(()=>{});

    // Anonymous auth so writes are tied to a user session (configure rules below)
    const authState = document.getElementById('authState');
    const signOutBtn = document.getElementById('signOutBtn');
    auth.onAuthStateChanged(async (user)=>{
      if(!user){
        await auth.signInAnonymously();
      } else {
        authState.textContent = `Online · ${user.isAnonymous? 'Guest' : user.email||'User'}`;
        signOutBtn.style.display = user.isAnonymous ? 'none' : 'inline-flex';
      }
    });
    signOutBtn.onclick = ()=> auth.signOut();

    // DOM helpers
    const grid = document.getElementById('grid');
    const modalBack = document.getElementById('modalBack');
    const modalImg = document.getElementById('modalImg');
    const modalTitle = document.getElementById('modalTitle');
    const modalSub = document.getElementById('modalSub');
    const descTA = document.getElementById('desc');
    const deleteBtn = document.getElementById('deleteBtn');
    const closeBtn = document.getElementById('closeBtn');
    const toast = document.getElementById('toast');

    // Build 100 cells upfront
    const docRef = (i)=> db.collection('frames').doc(String(i));

    for(let i=0;i<100;i++){
      const cell = document.createElement('div');
      cell.className = 'cell';
      cell.dataset.index = i;

      const img = document.createElement('img');
      img.className = 'thumb';
      img.loading = 'lazy';
      img.style.display = 'none';

      const ph = document.createElement('div');
      ph.className = 'placeholder';
      ph.innerHTML = `
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M4 5a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V5Z" stroke="#6b7a90" stroke-width="1.4"/>
          <path d="M7 16l3-3 3 3 4-4 2 2" stroke="#6b7a90" stroke-width="1.4"/>
          <circle cx="9" cy="8" r="1.5" stroke="#6b7a90" stroke-width="1.4"/>
        </svg>
        <div>Click to upload</div>`;

      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*';

      const overlay = document.createElement('div');
      overlay.className = 'overlay';
      const edit = document.createElement('button');
      edit.className = 'edit';
      edit.textContent = 'Open';
      overlay.appendChild(edit);

      cell.append(img, ph, input, overlay);
      grid.appendChild(cell);

      // Click-to-upload
      input.addEventListener('change', async (e)=>{
        const file = e.target.files?.[0];
        if(!file) return;
        await uploadToFrame(i, file);
      });

      // Open modal
      edit.addEventListener('click', ()=> openModal(i));
      img.addEventListener('click', ()=> openModal(i));

      // Live subscribe for this frame
      docRef(i).onSnapshot(snap=>{
        const data = snap.data();
        if(data?.imageURL){
          img.src = data.imageURL; img.style.display='block'; ph.style.display='none';
        }else{ img.style.display='none'; ph.style.display='flex'; }
      });

      // Allow drag & drop directly on the tile
      ;['dragenter','dragover'].forEach(ev=>cell.addEventListener(ev,(e)=>{e.preventDefault();cell.style.outline='2px dashed #3057a8'}));
      ;['dragleave','drop'].forEach(ev=>cell.addEventListener(ev,(e)=>{e.preventDefault();cell.style.outline='none'}));
      cell.addEventListener('drop', async (e)=>{
        const file = e.dataTransfer.files?.[0];
        if(file) await uploadToFrame(i,file);
      });
    }

    async function uploadToFrame(index, file){
      const id = `${index}-${Date.now()}`;
      const ref = storage.ref().child(`frames/${id}`);
      await ref.put(file);
      const url = await ref.getDownloadURL();
      await docRef(index).set({ imageURL: url, description: "", updatedAt: firebase.firestore.FieldValue.serverTimestamp() }, { merge:true });
      showToast('Image uploaded');
    }

    // Modal logic
    let currentIndex = null; let saveTimer = null;
    async function openModal(index){
      currentIndex = index;
      const snap = await docRef(index).get();
      const data = snap.data()||{};
      modalTitle.textContent = `Frame #${index+1}`;
      modalSub.textContent = data.updatedAt?.toDate ? `Updated ${data.updatedAt.toDate().toLocaleString()}` : 'Not saved yet';
      modalImg.src = data.imageURL || '';
      descTA.value = data.description || '';
      document.body.style.overflow='hidden';
      modalBack.style.display='flex';
      modalBack.setAttribute('aria-hidden','false');
    }

    function closeModal(){
      modalBack.style.display='none';
      modalBack.setAttribute('aria-hidden','true');
      document.body.style.overflow='auto';
      currentIndex=null;
    }

    closeBtn.onclick = closeModal;
    modalBack.addEventListener('click', (e)=>{ if(e.target===modalBack) closeModal(); });

    // Autosave description (debounced)
    descTA.addEventListener('input', ()=>{
      if(currentIndex==null) return;
      clearTimeout(saveTimer);
      saveTimer = setTimeout(async ()=>{
        await docRef(currentIndex).set({ description: descTA.value, updatedAt: firebase.firestore.FieldValue.serverTimestamp() }, { merge:true });
        showToast('Saved');
      }, 500);
    });

    // Delete
    deleteBtn.addEventListener('click', async ()=>{
      if(currentIndex==null) return;
      const confirmDel = confirm('Remove image & description from this frame?');
      if(!confirmDel) return;
      await docRef(currentIndex).set({ imageURL: firebase.firestore.FieldValue.delete(), description: "", updatedAt: firebase.firestore.FieldValue.serverTimestamp() }, { merge:true });
      modalImg.src=''; descTA.value='';
      showToast('Cleared');
    });

    // Bulk upload helper
    document.getElementById('bulkUpload').addEventListener('change', async (e)=>{
      const files = Array.from(e.target.files||[]).slice(0,100);
      if(files.length===0) return;
      // Fill empty frames first
      const snaps = await db.collection('frames').get();
      const taken = new Set(snaps.docs.filter(d=>d.data().imageURL).map(d=>Number(d.id)));
      let idx=0;
      for(let i=0;i<100 && idx<files.length;i++){
        if(!taken.has(i)){
          await uploadToFrame(i, files[idx]);
          idx++;
        }
      }
      showToast(`Uploaded ${idx} image(s)`);
    });

    // Export metadata
    document.getElementById('exportJSON').addEventListener('click', async ()=>{
      const snaps = await db.collection('frames').orderBy(firebase.firestore.FieldPath.documentId()).get();
      const data = snaps.docs.map((d,i)=>({ index:i, ...(d.data()||{}) }));
      const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
      const a = Object.assign(document.createElement('a'), { href:URL.createObjectURL(blob), download:'frames.json' });
      a.click();
    });

    function showToast(msg){
      toast.textContent = msg + ' ✓';
      toast.style.display='block';
      clearTimeout(showToast.t);
      showToast.t = setTimeout(()=>toast.style.display='none', 1200);
    }
  </script>

  <!--
  ─────────────────────────────────────────────────────────────────────
  FIREBASE SECURITY RULES (set these in Firebase Console → Firestore/Storage)
  Firestore rules (simple: anyone can read; authenticated users—including anonymous—can write):

  rules_version = '2';
  service cloud.firestore {
    match /databases/{database}/documents {
      match /frames/{docId} {
        allow read: if true;
        allow write: if request.auth != null; // anon ok
      }
    }
  }

  Storage rules (restrict to images, authenticated users only):

  rules_version = '2';
  service firebase.storage {
    match /b/{bucket}/o {
      match /frames/{allPaths=**} {
        allow read: if true;
        allow write: if request.auth != null &&
                      request.resource.contentType.matches('image/.*') &&
                      request.resource.size < 15 * 1024 * 1024; // 15MB
      }
    }
  }

  Optional: enable Authentication → Sign-in method → Anonymous
  ─────────────────────────────────────────────────────────────────────
  -->
</body>
</html>

