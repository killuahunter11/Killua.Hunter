<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>My Online Photo Wall</title>
  <style>
    :root{
      --bg:#0b0f14; --card:#111827; --muted:#1f2937; --text:#e5e7eb; --sub:#94a3b8; --accent:#60a5fa; --ok:#22c55e; --warn:#f59e0b; --err:#ef4444;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#0b0f14,#0d1117);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
    header{position:sticky;top:0;z-index:5;background:rgba(13,17,23,.7);backdrop-filter:blur(8px);border-bottom:1px solid #111a;}
    .wrap{max-width:1200px;margin:0 auto;padding:16px}
    h1{margin:0;font-size:20px;font-weight:700}
    .sub{color:var(--sub);font-size:13px}

    .grid{display:grid;gap:8px;padding:16px;max-width:1200px;margin:0 auto}
    /* 10x10 on large, responsive down */
    @media (min-width:1100px){.grid{grid-template-columns:repeat(10, 1fr)}}
    @media (max-width:1099px) and (min-width:900px){.grid{grid-template-columns:repeat(8, 1fr)}}
    @media (max-width:899px) and (min-width:700px){.grid{grid-template-columns:repeat(6, 1fr)}}
    @media (max-width:699px) and (min-width:520px){.grid{grid-template-columns:repeat(4, 1fr)}}
    @media (max-width:519px){.grid{grid-template-columns:repeat(2, 1fr)}}

    .tile{position:relative;aspect-ratio:1/1;border-radius:12px;overflow:hidden;background:var(--card);border:1px solid #1f2937;display:flex;align-items:center;justify-content:center;cursor:pointer;}
    .tile:hover{outline:2px solid #243447}
    .tile img{width:100%;height:100%;object-fit:cover;display:block}
    .tile .empty{display:flex;flex-direction:column;align-items:center;gap:6px;color:#94a3b8}
    .tile .empty svg{opacity:.7}

    .badge{position:absolute;inset:auto 8px 8px auto;background:#0b1220a6;border:1px solid #2a3b51;color:#9cc1ff;font-size:11px;padding:4px 6px;border-radius:8px}

    .controls{display:flex;gap:8px;align-items:center;justify-content:space-between}
    button, .btn{appearance:none;border:1px solid #243447;background:#0e1622;color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
    button:hover,.btn:hover{background:#142136}
    .pill{padding:6px 10px;border-radius:999px;border:1px solid #243447;color:#9fb4d3;background:#0e1622}

    /* Modal */
    dialog{width:min(900px,94vw);background:#0c131d;border:1px solid #243447;border-radius:16px;color:var(--text);padding:0;}
    dialog::backdrop{background:rgba(0,0,0,.6)}
    .modal-head{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid #1d2736}
    .modal-body{display:grid;grid-template-columns:1.2fr .8fr;gap:0;border-bottom-left-radius:16px;border-bottom-right-radius:16px}
    .modal-img{background:#0a0f17;display:flex;align-items:center;justify-content:center;min-height:320px}
    .modal-img img{max-width:100%;max-height:72vh;border-bottom-left-radius:16px}
    .meta{padding:16px;border-left:1px solid #1d2736}
    .meta h3{margin:0 0 8px 0;font-size:16px}
    .meta label{display:block;font-size:12px;color:#a8b3c7;margin:10px 0 6px}
    .meta textarea{width:100%;min-height:140px;border-radius:10px;background:#0b1220;border:1px solid #22324a;color:var(--text);padding:10px;resize:vertical}
    .muted{color:#9aa7bd;font-size:12px}
    .row{display:flex;gap:8px;align-items:center}
    .save-state{font-size:12px}
    .save-dot{width:8px;height:8px;border-radius:999px;background:#64748b;display:inline-block;margin-right:6px}
    .save-dot.saving{background:var(--warn)}
    .save-dot.saved{background:var(--ok)}
    .save-dot.error{background:var(--err)}

    .footer{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-top:1px solid #1d2736}

    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="controls">
        <div>
          <h1>My Photo Wall</h1>
          <div class="sub">100-frame gallery â€¢ Click any square to upload or edit â€¢ Auto-saves online</div>
        </div>
        <div class="row">
          <span id="authState" class="pill">Connectingâ€¦</span>
          <button id="signOutBtn" style="display:none">Sign out</button>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="grid" id="grid"></div>
  </main>

  <dialog id="editor">
    <div class="modal-head">
      <div class="row">
        <strong id="modalTitle">Frame</strong>
        <span class="pill" id="fileSize"></span>
      </div>
      <div class="row">
        <button id="replaceBtn">Replace image</button>
        <button id="deleteBtn" style="border-color:#3b1d1d;background:#1b0e0e">Delete</button>
        <button id="closeBtn" aria-label="Close">Close âœ•</button>
      </div>
    </div>
    <div class="modal-body">
      <div class="modal-img"><img id="modalImg" alt="Selected" /></div>
      <div class="meta">
        <h3>Details</h3>
        <label for="desc">Description</label>
        <textarea id="desc" placeholder="Write something about this photoâ€¦"></textarea>
        <div class="row" style="margin-top:10px;justify-content:space-between">
          <div class="save-state"><span class="save-dot" id="saveDot"></span><span id="saveText">Idle</span></div>
          <div class="muted" id="updatedAt"></div>
        </div>
      </div>
    </div>
    <div class="footer">
      <div class="muted">Tip: your gallery is private to your account (anonymous sign-in). Deploy this file anywhere.</div>
      <div class="row">
        <button id="downloadBtn">Download image</button>
      </div>
    </div>
  </dialog>

  <input type="file" id="fileInput" accept="image/*" class="sr-only" />

  <!-- Firebase v10 CDN (modular) -->
  <script type="module">
    /******************
     * ðŸ”§ 1) Firebase config â€” REPLACE with your own project's keys from console.firebase.google.com
     ******************/
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      appId: "YOUR_APP_ID",
    };

    // --- SDK imports via CDN ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, onSnapshot, serverTimestamp, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";
    import { getStorage, ref, uploadBytesResumable, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-storage.js";

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // UI elements
    const grid = document.getElementById('grid');
    const fileInput = document.getElementById('fileInput');
    const authState = document.getElementById('authState');
    const signOutBtn = document.getElementById('signOutBtn');

    const editor = document.getElementById('editor');
    const modalImg = document.getElementById('modalImg');
    const modalTitle = document.getElementById('modalTitle');
    const fileSizeEl = document.getElementById('fileSize');
    const desc = document.getElementById('desc');
    const saveDot = document.getElementById('saveDot');
    const saveText = document.getElementById('saveText');
    const updatedAt = document.getElementById('updatedAt');
    const closeBtn = document.getElementById('closeBtn');
    const replaceBtn = document.getElementById('replaceBtn');
    const deleteBtn = document.getElementById('deleteBtn');
    const downloadBtn = document.getElementById('downloadBtn');

    let current = { slot: null, data: null, uid: null };

    // Helpers
    const fmtBytes = (b)=>{
      if(!b && b!==0) return '';
      const u=['B','KB','MB','GB'];
      let i=0; while(b>=1024 && i<u.length-1){b/=1024;i++}
      return `${b.toFixed(1)} ${u[i]}`
    }
    const debounce = (fn,ms=600)=>{let t;return(...a)=>{clearTimeout(t);t=setTimeout(()=>fn(...a),ms)}}

    // Build 100 tiles
    const tiles = [];
    for (let i=0;i<100;i++){
      const tile = document.createElement('div');
      tile.className = 'tile';
      tile.dataset.slot = i;
      tile.innerHTML = `
        <div class="empty">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 16l5-5 4 4 5-6 4 4"/></svg>
          <span>Click to upload</span>
        </div>
        <span class="badge">#${String(i+1).padStart(2,'0')}</span>
      `;
      tile.addEventListener('click', ()=> onTileClick(tile));
      grid.appendChild(tile);
      tiles.push(tile);
    }

    // Auth + init
    onAuthStateChanged(auth, async (user)=>{
      if (!user){
        authState.textContent = 'Signing inâ€¦';
        signInAnonymously(auth).catch(err=>{
          authState.textContent = 'Auth error';
          console.error(err);
        });
        return;
      }
      current.uid = user.uid;
      authState.textContent = 'Signed in';
      signOutBtn.style.display = '';

      // Attach listeners for each slot
      tiles.forEach((tile)=> attachSlotListener(tile));
    });

    signOutBtn.addEventListener('click', ()=> signOut(auth));

    function slotDocRef(slot){
      return doc(db, 'users', current.uid, 'photos', String(slot));
    }

    function attachSlotListener(tile){
      const slot = tile.dataset.slot;
      onSnapshot(slotDocRef(slot), (snap)=>{
        const data = snap.data();
        renderTile(tile, data);
      });
    }

    function renderTile(tile, data){
      tile.innerHTML = '';
      tile.insertAdjacentHTML('beforeend', `<span class="badge">#${String(Number(tile.dataset.slot)+1).padStart(2,'0')}</span>`);
      if (data && data.url){
        const img = document.createElement('img');
        img.src = data.url;
        img.alt = data.description || 'Photo';
        tile.appendChild(img);
      } else {
        const empty = document.createElement('div');
        empty.className='empty';
        empty.innerHTML = `
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 16l5-5 4 4 5-6 4 4"/></svg>
          <span>Click to upload</span>`;
        tile.appendChild(empty);
      }
    }

    async function onTileClick(tile){
      const slot = tile.dataset.slot;
      const snap = await getDoc(slotDocRef(slot));
      const data = snap.exists()? snap.data(): null;
      if (!data || !data.url){
        // no image yet â€” choose file
        chooseAndUpload(slot);
      } else {
        openEditor(slot, data);
      }
    }

    function chooseAndUpload(slot){
      fileInput.value = '';
      fileInput.onchange = async (e)=>{
        const file = e.target.files?.[0];
        if (!file) return;
        await uploadToSlot(slot, file);
      };
      fileInput.click();
    }

    async function uploadToSlot(slot, file){
      const path = `uploads/${current.uid}/${slot}`;
      const sRef = ref(storage, path);
      const task = uploadBytesResumable(sRef, file);

      let tile = tiles[Number(slot)];
      tile.style.outline = '2px solid var(--warn)';

      await new Promise((resolve, reject)=>{
        task.on('state_changed', ()=>{}, reject, resolve);
      });
      const url = await getDownloadURL(sRef);

      const payload = {
        url,
        description: '',
        bytes: file.size,
        updatedAt: serverTimestamp(),
      };
      await setDoc(slotDocRef(slot), payload, { merge:true });
      tile.style.outline = '';
      openEditor(slot, payload);
    }

    function openEditor(slot, data){
      current.slot = slot;
      current.data = data;
      modalTitle.textContent = `Frame #${String(Number(slot)+1).padStart(2,'0')}`;
      modalImg.src = data.url;
      desc.value = data.description || '';
      fileSizeEl.textContent = data.bytes ? fmtBytes(data.bytes) : '';
      updatedAt.textContent = data.updatedAt?.toDate ? new Date(data.updatedAt.toDate()).toLocaleString() : '';
      setSaveState('idle');
      editor.showModal();
    }

    closeBtn.addEventListener('click', ()=> editor.close());

    replaceBtn.addEventListener('click', ()=>{
      if (current.slot==null) return;
      fileInput.value='';
      fileInput.onchange = async (e)=>{
        const file = e.target.files?.[0];
        if(!file) return;
        await uploadToSlot(current.slot, file);
      };
      fileInput.click();
    });

    deleteBtn.addEventListener('click', async ()=>{
      if (current.slot==null) return;
      if (!confirm('Delete this image and description?')) return;
      // delete storage object and firestore doc
      try{
        const path = `uploads/${current.uid}/${current.slot}`;
        await deleteObject(ref(storage, path)).catch(()=>{});
        await deleteDoc(slotDocRef(current.slot));
        editor.close();
      }catch(err){
        console.error(err);
        alert('Delete failed');
      }
    });

    downloadBtn.addEventListener('click', ()=>{
      if (!current?.data?.url) return;
      const a = document.createElement('a');
      a.href = current.data.url;
      a.download = `photo-${Number(current.slot)+1}.jpg`;
      document.body.appendChild(a); a.click(); a.remove();
    });

    const saveDesc = debounce(async ()=>{
      if (current.slot==null) return;
      setSaveState('saving');
      try{
        await setDoc(slotDocRef(current.slot), { description: desc.value, updatedAt: serverTimestamp() }, { merge: true });
        setSaveState('saved');
      }catch(err){
        console.error(err);
        setSaveState('error');
      }
    }, 600);

    desc.addEventListener('input', saveDesc);

    function setSaveState(state){
      saveDot.classList.remove('saving','saved','error');
      if (state==='saving'){ saveDot.classList.add('saving'); saveText.textContent = 'Savingâ€¦'; }
      else if (state==='saved'){ saveDot.classList.add('saved'); saveText.textContent = 'Saved'; setTimeout(()=>{saveText.textContent='Idle'; saveDot.classList.remove('saved')}, 1200); }
      else if (state==='error'){ saveDot.classList.add('error'); saveText.textContent = 'Error'; }
      else { saveText.textContent = 'Idle'; }
    }

    // Optional: Register a very simple service worker for offline viewing of cached assets
    if ('serviceWorker' in navigator){
      try{ navigator.serviceWorker.register(URL.createObjectURL(new Blob([`
        self.addEventListener('install',e=>self.skipWaiting());
        self.addEventListener('activate',e=>clients.claim());
        self.addEventListener('fetch',()=>{});
      `],{type:'text/javascript'}))); }catch(e){}
    }

  </script>

  <!--
  ==============================
  ðŸ”’ Firebase Security Rules (basic)
  ==============================
  Firestore rules example (Firestore -> Rules):

  rules_version = '2';
  service cloud.firestore {
    match /databases/{database}/documents {
      match /users/{uid}/photos/{slot} {
        allow read, write: if request.auth != null && request.auth.uid == uid;
      }
    }
  }

  Storage rules example (Storage -> Rules):

  rules_version = '2';
  service firebase.storage {
    match /b/{bucket}/o {
      match /uploads/{uid}/{slot} {
        allow read, write: if request.auth != null && request.auth.uid == uid;
      }
    }
  }

  ==============================
  ðŸš€ Deploying
  ==============================
  1) Create a Firebase project, enable Anonymous Authentication, Firestore, and Storage.
  2) Replace the firebaseConfig above with your project keys.
  3) Put this single index.html on Netlify, Vercel, GitHub Pages, or any static host.
  4) Done â€” images & descriptions save online per user account.
  -->
</body>
</html>
